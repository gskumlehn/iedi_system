{% extends "base.html" %}
{% block title %}Configurações - Sistema IEDI{% endblock %}
{% block content %}
<div class="page-header"><h1>Configurações do Sistema</h1></div>
<div class="card">
    <div class="card-header"><h2>Pesos das Variáveis</h2></div>
    <div class="card-body">
        <form id="config-form">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                <div class="form-group"><label>Título</label><input type="number" id="peso_titulo"></div>
                <div class="form-group"><label>Veículo Relevante</label><input type="number" id="peso_veiculo_relevante"></div>
                <div class="form-group"><label>Subtítulo/1º Parágrafo</label><input type="number" id="peso_subtitulo_1p"></div>
                <div class="form-group"><label>Veículo de Nicho</label><input type="number" id="peso_veiculo_nicho"></div>
                <div class="form-group"><label>Imagem</label><input type="number" id="peso_imagem"></div>
                <div class="form-group"><label>Porta-voz</label><input type="number" id="peso_porta_voz"></div>
            </div>
            <h3 style="margin-top:30px;">Pesos de Alcance</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                <div class="form-group"><label>Grupo A</label><input type="number" id="peso_alcance_a"></div>
                <div class="form-group"><label>Grupo B</label><input type="number" id="peso_alcance_b"></div>
                <div class="form-group"><label>Grupo C</label><input type="number" id="peso_alcance_c"></div>
                <div class="form-group"><label>Grupo D</label><input type="number" id="peso_alcance_d"></div>
            </div>
            <h3 style="margin-top:30px;">Outros</h3>
            <div class="form-group"><label>Bônus de Resposta (%)</label><input type="number" id="bonus_resposta"></div>
            <div class="form-actions"><button type="submit" class="btn btn-primary">Salvar Configurações</button></div>
        </form>
    </div>
</div>
{% endblock %}
{% block extra_js %}<script>
async function loadConfig() {
    const config = await fetch('/api/configuracoes').then(r => r.json());
    Object.keys(config).forEach(k => {
        const el = document.getElementById(k);
        if (el) el.value = config[k];
    });
}
document.getElementById('config-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {};
    ['peso_titulo','peso_veiculo_relevante','peso_subtitulo_1p','peso_veiculo_nicho',
     'peso_imagem','peso_porta_voz','peso_alcance_a','peso_alcance_b','peso_alcance_c',
     'peso_alcance_d','bonus_resposta'].forEach(k => {
        data[k] = document.getElementById(k).value;
    });
    await fetch('/api/configuracoes', {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
    alert('Configurações salvas!');
});
loadConfig();
</script>{% endblock %}
