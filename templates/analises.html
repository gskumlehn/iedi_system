{% extends "base.html" %}
{% block title %}Análises - Sistema IEDI{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Análises IEDI</h1>
    <p>Histórico de análises realizadas</p>
</div>
<div class="card">
    <div class="card-body">
        <table class="table">
            <thead><tr><th>ID</th><th>Período</th><th>Menções</th><th>Status</th><th>Data</th><th>Ações</th></tr></thead>
            <tbody id="analises-tbody"><tr><td colspan="6" class="text-center">Carregando...</td></tr></tbody>
        </table>
    </div>
</div>
{% endblock %}
{% block extra_js %}<script>
async function loadAnalises() {
    const analises = await fetch('/api/analises').then(r => r.json());
    const tbody = document.getElementById('analises-tbody');
    if (!analises.length) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhuma análise</td></tr>';
        return;
    }
    tbody.innerHTML = analises.map(a => `
        <tr>
            <td><strong>#${a.id}</strong></td>
            <td>${formatDate(a.data_inicio)} - ${formatDate(a.data_fim)}</td>
            <td>${a.total_mencoes||0}</td>
            <td><span class="badge badge-${a.status}">${a.status}</span></td>
            <td>${formatDateTime(a.created_at)}</td>
            <td><a href="/analise/${a.id}" class="btn btn-sm btn-secondary">Ver Detalhes</a></td>
        </tr>
    `).join('');
}
loadAnalises();
</script>{% endblock %}
