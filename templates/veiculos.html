{% extends "base.html" %}
{% block title %}Veículos - Sistema IEDI{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Gerenciamento de Veículos</h1>
</div>
<div class="card">
    <div class="card-header">
        <h2>Veículos Relevantes</h2>
        <button onclick="showAddRelevante()" class="btn btn-primary">+ Adicionar</button>
    </div>
    <div class="card-body">
        <table class="table">
            <thead><tr><th>Nome</th><th>Domínio</th><th>Status</th><th>Ações</th></tr></thead>
            <tbody id="relevantes-tbody"><tr><td colspan="4" class="text-center">Carregando...</td></tr></tbody>
        </table>
    </div>
</div>
<div class="card">
    <div class="card-header">
        <h2>Veículos de Nicho</h2>
        <button onclick="showAddNicho()" class="btn btn-primary">+ Adicionar</button>
    </div>
    <div class="card-body">
        <table class="table">
            <thead><tr><th>Nome</th><th>Domínio</th><th>Categoria</th><th>Status</th><th>Ações</th></tr></thead>
            <tbody id="nicho-tbody"><tr><td colspan="5" class="text-center">Carregando...</td></tr></tbody>
        </table>
    </div>
</div>
{% endblock %}
{% block extra_js %}<script>
async function loadVeiculos() {
    const [relevantes, nicho] = await Promise.all([
        fetch('/api/veiculos-relevantes').then(r => r.json()),
        fetch('/api/veiculos-nicho').then(r => r.json())
    ]);
    document.getElementById('relevantes-tbody').innerHTML = relevantes.length ? relevantes.map(v => `
        <tr><td>${v.nome}</td><td>${v.dominio}</td>
        <td><span class="badge badge-${v.ativo?'success':'secondary'}">${v.ativo?'Ativo':'Inativo'}</span></td>
        <td><button onclick="deleteVeiculo('relevante',${v.id})" class="btn btn-sm btn-danger">Excluir</button></td></tr>
    `).join('') : '<tr><td colspan="4" class="text-center">Nenhum veículo</td></tr>';
    document.getElementById('nicho-tbody').innerHTML = nicho.length ? nicho.map(v => `
        <tr><td>${v.nome}</td><td>${v.dominio}</td><td>${v.categoria||'-'}</td>
        <td><span class="badge badge-${v.ativo?'success':'secondary'}">${v.ativo?'Ativo':'Inativo'}</span></td>
        <td><button onclick="deleteVeiculo('nicho',${v.id})" class="btn btn-sm btn-danger">Excluir</button></td></tr>
    `).join('') : '<tr><td colspan="5" class="text-center">Nenhum veículo</td></tr>';
}
function showAddRelevante() {
    const nome = prompt('Nome do veículo:');
    const dominio = prompt('Domínio (ex: g1.globo.com):');
    if (nome && dominio) {
        fetch('/api/veiculos-relevantes', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({nome, dominio, ativo: true})
        }).then(() => { alert('Salvo!'); loadVeiculos(); });
    }
}
function showAddNicho() {
    const nome = prompt('Nome do veículo:');
    const dominio = prompt('Domínio:');
    const categoria = prompt('Categoria:');
    if (nome && dominio) {
        fetch('/api/veiculos-nicho', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({nome, dominio, categoria, ativo: true})
        }).then(() => { alert('Salvo!'); loadVeiculos(); });
    }
}
async function deleteVeiculo(tipo, id) {
    if (!confirm('Excluir?')) return;
    await fetch(`/api/veiculos-${tipo=='relevante'?'relevantes':'nicho'}/${id}`, {method:'DELETE'});
    alert('Excluído!');
    loadVeiculos();
}
loadVeiculos();
</script>{% endblock %}
